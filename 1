import productsApi from "@/api/products/products.api"
import { SearchBar } from "@/components/Navbar/SearchBar";
import { TypographyH1 } from "@/components/Typography/h1"
import { Input } from "@/components/ui/input";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Product } from "@/interfaces/Product.Interface"
import { useQuery } from "@tanstack/react-query"
import { ArrowRight, ExternalLink } from "lucide-react";
import { ChangeEvent, useState } from "react";
import { NavLink } from "react-router-dom";

export const DeleteBulkProducts = () => {
  const [take, setTake] = useState(9999)
  const [skip, setSkip] = useState(0)
  const [results, setResults] = useState<Product[]>()

  const { data: products, refetch } = useQuery<Product[]>({
    queryKey: ["all-products"],
    queryFn: () => productsApi.GetAllProducts(take, skip),
  })

  const paginateFwd = () => {
    setTake((prev) => prev + 10)
    setSkip((prev) => prev + 10)
    console.log(take)
  }

  const search = (e: ChangeEvent<HTMLInputElement>) => {
    refetch()
    const searchResults = products?.filter((p) => p.name.includes(e.target.value))
    setResults(searchResults)
  }

  return (
    <div className="space-y-4">

      <TypographyH1>Eliminar productos</TypographyH1>
      <Table className="block !h-[24rem] overflow-y-scroll border border-gray-500 rounded-sm w-fit">
        <TableHeader className="flex flex-col sticky top-0 shadow-[0_5px_30px_-15px_rgba(0,0,0,0.3)] bg-[#ecefdc]">
          <div className="bg-[#ecefdc] relative">
            <Input onChange={search} className="!border-gray-500 border-b-2 rounded-none" />
            <SearchBar />
          </div>

          <div>
            <TableHead></TableHead>
            <TableHead>Nombre</TableHead>
            <TableHead>Precio</TableHead>
            <TableHead>Categoria</TableHead>
          </div>

        </TableHeader>
        <TableBody className="">
          {results?.map((p) => (
            <TableRow className="">
              <TableCell >
                <form>
                  <Input type="checkbox" className="w-min" />
                </form>
              </TableCell>
              <TableCell className="">
                <NavLink target="_blank" to={`/producto/${p.id}`} className="underline text-blue-500 flex items-center gap-1">
                  {p.name}
                  <ExternalLink size={20} />
                </NavLink>

              </TableCell>


              <TableCell>{p.price}</TableCell>
              <TableCell>{p?.category?.category_name}</TableCell>
            </TableRow>

          ))}
        </TableBody>

      </Table>
      <ArrowRight onClick={paginateFwd} className="cursor-pointer" />

    </div>
  )
}
